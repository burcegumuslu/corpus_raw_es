{"title": "Control de eventos PnP y de administraci\u00f3n de energ\u00eda en un controlador de protocolo - Windows drivers", "author": null, "url": "https://learn.microsoft.com/es-es/windows-hardware/drivers/network/handling-pnp-events-and-power-management-events-in-a-protocol-driver", "hostname": "microsoft.com", "description": "Controlar eventos PnP y eventos de administraci\u00f3n de energ\u00eda en un controlador de protocolo", "sitename": "MicrosoftLearn", "date": "2023-01-06", "id": null, "license": null, "body": null, "comments": "", "commentsbody": null, "raw_text": null, "text": "Controlar eventos PnP y eventos de administraci\u00f3n de energ\u00eda en un controlador de protocolo\nCuando el sistema operativo emite un paquete de solicitud de E/S (PnP) Plug and Play (IRP) o un IRP de administraci\u00f3n de energ\u00eda a un objeto de dispositivo de destino que representa una tarjeta de interfaz de red (NIC), NDIS intercepta el IRP. NDIS indica el evento para cada controlador de protocolo enlazado y cada controlador intermedio enlazado llamando a la funci\u00f3n\n[ProtocolNetPnPEvent](/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event) del controlador. En la llamada a ProtocolNetPnPEvent, NDIS pasa un puntero a un [NET_PNP_EVENT_NOTIFICATION](/es-es/windows-hardware/drivers/ddi/ndis/ns-ndis-_net_pnp_event_notification) que contiene una estructura de NET_PNP_EVENT. La estructura NET_PNP_EVENT describe el evento PnP o el evento de administraci\u00f3n de energ\u00eda que se indica. Para obtener m\u00e1s informaci\u00f3n sobre la interfaz PnP del controlador de protocolo, consulte [Control de notificaciones de eventos PnP en un controlador de protocolo](handling-pnp-event-notifications-in-a-protocol-driver).\nLa lista siguiente contiene eventos PnP y de administraci\u00f3n de energ\u00eda, como se indica en el c\u00f3digo NetEvent de la estructura NET_PNP_EVENT:\nNetEventSetPower\nIndica una solicitud Establecer energ\u00eda, que especifica que el adaptador de minipuerto debe pasar a un estado de alimentaci\u00f3n determinado. Un controlador de protocolo compatible con la administraci\u00f3n de energ\u00eda siempre debe tener \u00e9xito este evento devolviendo NDIS_STATUS_SUCCESS. Un controlador de protocolo antiguo puede devolver NDIS_STATUS_NOT_SUPPORTED para indicar que NDIS debe desenlacerlo desde el adaptador de minipuerto.\nDespu\u00e9s de emitir la solicitud de alimentaci\u00f3n establecida, NDIS pausa la pila del controlador si el adaptador de minipuerto pasa a un estado de bajo consumo. NDIS reinicia la pila de controladores antes de la solicitud set-power si el adaptador de minipuerto pasa al estado de trabajo (D0). Para obtener m\u00e1s informaci\u00f3n sobre c\u00f3mo pausar y reiniciar la pila de controladores, consulte\n[Pausar una pila de controladores](pausing-a-driver-stack).\nSi el adaptador de minipuerto est\u00e1 en un estado de bajo consumo, el controlador de protocolo no puede emitir ninguna solicitud de OID. Este requisito es una restricci\u00f3n adicional de administraci\u00f3n de energ\u00eda que se agrega a las dem\u00e1s restricciones que se aplican cuando la pila de controladores est\u00e1 en estado Pausado.\nSi el adaptador de minipuerto subyacente no tiene en cuenta la administraci\u00f3n de energ\u00eda, el controlador de minipuerto establece el miembro PowerManagementCapabilities de\n[NDIS_MINIPORT_ADAPTER_GENERAL_ATTRIBUTES](/es-es/windows-hardware/drivers/ddi/ndis/ns-ndis-_ndis_miniport_adapter_general_attributes)en NULL y NDIS establece el miembro PowerManagementCapabilities de [NDIS_BIND_PARAMETERS](/es-es/windows-hardware/drivers/ddi/ndis/ns-ndis-_ndis_bind_parameters)en NULL.\nNota A partir de NDIS 6.30, despu\u00e9s de recibir una notificaci\u00f3n de este evento, el controlador de protocolo debe dejar de generar nuevas solicitudes de E/S y no debe esperar a que se completen las solicitudes de E/S pendientes en el contexto de la llamada a\n[ProtocolNetPnPEvent](/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event).\nPara obtener m\u00e1s informaci\u00f3n sobre los eventos de configuraci\u00f3n de energ\u00eda, vea\n[Controlar eventos PnP y eventos de administraci\u00f3n de energ\u00eda en un controlador intermedio](handling-pnp-events-and-power-management-events-in-an-intermediate-dri).\nNetEventQueryPower\nIndica una solicitud de power de consulta, que consulta si el adaptador de minipuerto subyacente puede realizar una transici\u00f3n a un estado de alimentaci\u00f3n determinado. Un controlador de protocolo siempre debe tener \u00e9xito en NetEventQueryPower . Despu\u00e9s de establecer una conexi\u00f3n activa, un controlador de protocolo puede llamar a\n[PoRegisterSystemState](/es-es/windows-hardware/drivers/ddi/ntifs/nf-ntifs-poregistersystemstate)para registrar un estado ocupado continuo. Siempre que el registro de estado est\u00e9 en vigor, el administrador de energ\u00eda no intenta poner el sistema en suspensi\u00f3n. Una vez inactiva la conexi\u00f3n, el controlador de protocolo cancela el registro de estado mediante una llamada [a PoUnregisterSystemState](/es-es/windows-hardware/drivers/ddi/ntifs/nf-ntifs-pounregistersystemstate). Un controlador de protocolo nunca debe intentar evitar que el sistema realice la transici\u00f3n al estado de suspensi\u00f3n mediante un error de NetEventQueryRemoveDevice. Tenga en cuenta que NetEventQueryPower siempre va seguido de NetEventSetPower. Un NetEventSetPower que establece el estado de energ\u00eda actual del dispositivo en vigor cancela NetEventQueryPower.\nNota A partir de NDIS 6.30, despu\u00e9s de recibir una notificaci\u00f3n de este evento, el controlador de protocolo no debe esperar a que se completen las solicitudes de E/S pendientes en el contexto de la llamada a\n[ProtocolNetPnPEvent](/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event).\nNetEventQueryRemoveDevice\nIndica una solicitud de eliminaci\u00f3n de dispositivo de consulta, que consulta si la NIC se puede quitar sin interrumpir las operaciones. Si un controlador de protocolo no puede liberar un dispositivo (por ejemplo, porque el dispositivo est\u00e1 en uso), debe producir un error en un netEventQueryRemoveDevice devolviendo NDIS_STATUS_FAILURE.\nNetEventCancelRemoveDevice\nIndica una solicitud Cancelar quitar dispositivo, que cancela la eliminaci\u00f3n de una NIC subyacente. El controlador de protocolo siempre debe realizar correctamente este evento devolviendo NDIS_STATUS_SUCCESS.\nNetEventReconfigure\nIndica que la configuraci\u00f3n ha cambiado para un componente de red. Por ejemplo, si un usuario cambia la direcci\u00f3n IP de TCP/IP, NDIS indica este evento en el protocolo TCP/IP con el c\u00f3digo NetEventReconfigure . El controlador de protocolo puede, en raras circunstancias, devolver un c\u00f3digo de error si no puede aplicar los cambios de configuraci\u00f3n indicados y no hay valores predeterminados disponibles. Un intento err\u00f3neo de asignar memoria es un ejemplo de un caso en el que el protocolo devuelve un c\u00f3digo de error. Devolver un c\u00f3digo de error puede provocar que el usuario reinicie el sistema.\nUn protocolo debe validar los datos relacionados con NetEventReconfigure pasados a su funci\u00f3n\n[ProtocolNetPnPEvent](/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event). Para obtener m\u00e1s informaci\u00f3n sobre estos datos, consulte [NET_PNP_EVENT para controladores de protocolo](/es-es/windows-hardware/drivers/ddi/netpnp/ns-netpnp-_net_pnp_event).\nNetEventBindList\nIndica a un controlador de protocolo que se ha reconfigurado el orden de procesamiento de la lista de enlaces. Esta lista indica un orden relativo que se va a aplicar a los enlaces del protocolo al procesar, por ejemplo, una solicitud de usuario que podr\u00eda enrutarse a uno de varios enlaces. El b\u00fafer pasado con este evento contiene una lista de nombres de dispositivo con formato de cadenas Unicode terminadas en NULL. El formato de cada nombre de dispositivo es id\u00e9ntico al par\u00e1metro DeviceName que se pasa a una llamada a\n[ProtocolBindAdapterEx](/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_bind_adapter_ex).\nUn protocolo debe validar los datos relacionados con NetEventBindList pasados a su funci\u00f3n ProtocolNetPnPEvent . Para obtener m\u00e1s informaci\u00f3n sobre estos datos, consulte\n[NET_PNP_EVENT para controladores de protocolo](/es-es/windows-hardware/drivers/ddi/netpnp/ns-netpnp-_net_pnp_event).\nUn protocolo debe validar los datos relacionados con NetEventBindList pasados a su funci\u00f3n ProtocolNetPnPEvent . Para obtener m\u00e1s informaci\u00f3n sobre estos datos, consulte\n[NET_PNP_EVENT para controladores de protocolo](/es-es/windows-hardware/drivers/ddi/netpnp/ns-netpnp-_net_pnp_event).\nNetEventBindsComplete\nIndica que un controlador de protocolo se ha enlazado a todas las NIC a las que se puede enlazar. NDIS no indicar\u00e1 m\u00e1s enlaces al controlador de protocolo a menos que, por ejemplo, una NIC PnP est\u00e9 conectada al sistema.\nNetEventPnPCapabilities\nIndica que el usuario ha habilitado o deshabilitado las funcionalidades de reactivaci\u00f3n del adaptador subyacente. (El par\u00e1metro ProtocolBindingContext que NDIS pasa a ProtocolNetPnPEvent especifica el enlace).\nNetEventPause\nIndica que el enlace de protocolo especificado debe entrar en el estadoPausing. El enlace entrar\u00e1 en el estado Pausado despu\u00e9s de que NDIS haya completado todas las solicitudes de env\u00edo pendientes para el enlace. Para obtener m\u00e1s informaci\u00f3n sobre c\u00f3mo pausar un enlace, consulte\n[Pausar un enlace](pausing-a-binding).\nNetEventRestart\nIndica que el enlace de protocolo especificado ha entrado en el estado Reinicio. Despu\u00e9s de que el controlador de protocolo est\u00e9 listo para reanudar las operaciones de env\u00edo y recepci\u00f3n del enlace, el enlace entra en estado En ejecuci\u00f3n. Para obtener m\u00e1s informaci\u00f3n sobre c\u00f3mo reiniciar un enlace, vea\n[Reiniciar un enlace](restarting-a-binding).\nNetEventPortActivation\nIndica la activaci\u00f3n de una lista de puertos asociados al enlace especificado. Para obtener m\u00e1s informaci\u00f3n sobre c\u00f3mo pausar un enlace, consulte\n[Control del evento PnP de activaci\u00f3n](handling-the-port-activation-pnp-event)de puerto.\nNetEventPortDeactivation\nIndica la desactivaci\u00f3n de una lista de puertos asociados al enlace especificado. Para obtener m\u00e1s informaci\u00f3n sobre c\u00f3mo pausar un enlace, consulte\n[Control del evento PnP de desactivaci\u00f3n](handling-the-port-deactivation-pnp-event)de puertos.\nNetEventIMReEnableDevice\nIndica que la configuraci\u00f3n ha cambiado para un miniporte virtual de un controlador intermedio NDIS 6.0 o posterior. NetEventIMReEnableDevice es similar al evento NetEventReconfigure , salvo que el controlador intermedio recibe este evento para un \u00fanico miniport virtual y el evento NetEventReconfigure se aplica a todos los miniportes virtuales del controlador intermedio. Por ejemplo, un controlador intermedio recibe el evento NetEventIMReEnableDevice cuando un usuario deshabilita y, a continuaci\u00f3n, habilita un \u00fanico miniport virtual desde el Administrador de dispositivos u otro origen. Para obtener ejemplos de administraci\u00f3n intermedia de energ\u00eda del controlador, consulte el ejemplo de controlador\n[intermedio NDIS MUX y Notificar controlador de objeto](https://github.com/microsoft/Windows-driver-samples/tree/95037b3f77f3a745f7682f991ac80e81f91f5362/network/ndis/mux)disponible en el repositorio de [ejemplos de controladores de Windows](https://github.com/Microsoft/Windows-driver-samples/tree/develop)en GitHub.\nEl miembro Buffer de la estructura NET_PNP_EVENT apunta a un b\u00fafer que contiene informaci\u00f3n espec\u00edfica del evento que se indica.\nUn controlador de protocolo puede completar la llamada a ProtocolNetPnPEvent de forma asincr\u00f3nica con\n[NdisCompleteNetPnPEvent](/es-es/windows-hardware/drivers/ddi/ndis/nf-ndis-ndiscompletenetpnpevent).", "language": null, "image": "https://learn.microsoft.com/en-us/media/open-graph-image.png", "pagetype": "website", "links": ["#main", "https://go.microsoft.com/fwlink/p/?LinkID=2092881 ", "https://learn.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge", "https://www.microsoft.com", null, null, null, null, null, null, "/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event", "/es-es/windows-hardware/drivers/ddi/ndis/ns-ndis-_net_pnp_event_notification", "handling-pnp-event-notifications-in-a-protocol-driver", "pausing-a-driver-stack", "/es-es/windows-hardware/drivers/ddi/ndis/ns-ndis-_ndis_miniport_adapter_general_attributes", "/es-es/windows-hardware/drivers/ddi/ndis/ns-ndis-_ndis_bind_parameters", "/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event", "handling-pnp-events-and-power-management-events-in-an-intermediate-dri", "/es-es/windows-hardware/drivers/ddi/ntifs/nf-ntifs-poregistersystemstate", "/es-es/windows-hardware/drivers/ddi/ntifs/nf-ntifs-pounregistersystemstate", "/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event", "/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_net_pnp_event", "/es-es/windows-hardware/drivers/ddi/netpnp/ns-netpnp-_net_pnp_event", "/es-es/windows-hardware/drivers/ddi/ndis/nc-ndis-protocol_bind_adapter_ex", "/es-es/windows-hardware/drivers/ddi/netpnp/ns-netpnp-_net_pnp_event", "/es-es/windows-hardware/drivers/ddi/netpnp/ns-netpnp-_net_pnp_event", "pausing-a-binding", "restarting-a-binding", "handling-the-port-activation-pnp-event", "handling-the-port-deactivation-pnp-event", "https://github.com/microsoft/Windows-driver-samples/tree/95037b3f77f3a745f7682f991ac80e81f91f5362/network/ndis/mux", "https://github.com/Microsoft/Windows-driver-samples/tree/develop", "/es-es/windows-hardware/drivers/ddi/ndis/nf-ndis-ndiscompletenetpnpevent", "#", "/es-es/previous-versions/", "https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog", "/es-es/contribute/", "https://go.microsoft.com/fwlink/?LinkId=521839", "/es-es/legal/termsofuse", "https://www.microsoft.com/legal/intellectualproperty/Trademarks/", "#", "/es-es/previous-versions/", "https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog", "/es-es/contribute/", "https://go.microsoft.com/fwlink/?LinkId=521839", "/es-es/legal/termsofuse", "https://www.microsoft.com/legal/intellectualproperty/Trademarks/"]}